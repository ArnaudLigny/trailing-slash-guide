<html>
<body>
  <script type="module">
      import {markdownTable} from "https://cdn.skypack.dev/markdown-table@3.0.0";

      async function fetchUrl(url) {
        // Using {redirect: "manual"} is not a good solution => shows status=0 + redirect url is not accessible
        const response = await fetch(url)
        console.log({url,response});
        // Even when there's a redirect, status is 200 because fetch follows redirects
        if (response.status !== 200) {
          throw new Error(`Bad response for url= ${url} => ${response.status}`)
        }
        return {
          url,
          redirectUrl: response.redirected ? new URL(response.url).pathname : undefined
        };
      }

      function addUrlResultToDOM(result) {
        const div = document.createElement("div");
        const a = document.createElement('a');
        a.appendChild(document.createTextNode(result.url));
        a.href = result.url;

        const text = result.redirectUrl ? ` ➡️ ${result.redirectUrl}` : '✅'
        div.appendChild(a);
        div.appendChild(document.createTextNode(" - "));
        div.appendChild(document.createTextNode(text));

        document.body.appendChild(div);
      }

      function printMarkdownTable(results) {
        const markdownTableString = markdownTable([
          ['Url', 'Redirect Url'],
          ...results.map(result => [result.url, result.redirectUrl ? `➡️ ${result.redirectUrl}` : '✅'])
        ]);
        console.log("markdownTableString:");
        console.log(markdownTableString);
      }

      async function run() {
        const Urls = [
          "file",
          "file/",
          "folder",
          "folder/",
          "both",
          "both/",
        ];
        const results = await Promise.all(Urls.map(fetchUrl))

        results.forEach(addUrlResultToDOM);

        printMarkdownTable(results);
      }

      run().catch(e => {
        console.error(e);
        alert("Error, check the console: " + e.message);
      });

  </script>
</body>
</html>
