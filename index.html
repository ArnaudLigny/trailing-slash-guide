<html>
<body>
  <script type="module">
      import {markdownTable} from "https://cdn.skypack.dev/markdown-table@3.0.0";

      async function fetchUrl(url) {
        const response = await fetch(
                url,
                // {redirect: 'manual'}
        )
        // console.log("response", {url,response});
        return {
          url,
          redirectUrl: response.redirected ? new URL(response.url).pathname : undefined
          // status: response.status,
          // redirectLocation: response.headers.get("Location")
        };
      }

      function addUrlResultToDOM(result) {
        console.log("processUrl",{result});


        const div = document.createElement("div");
        const a = document.createElement('a');
        a.appendChild(document.createTextNode(result.url));
        a.href = result.url;

        const text = result.redirectUrl ? ` ===> ${result.redirectUrl}` : ""
        div.appendChild(a);
        div.appendChild(document.createTextNode(text));

        document.body.appendChild(div);
      }

      function printMarkdownTable(results) {
        const markdownTableString = markdownTable([
          ['Url', 'Redirect Url'],
          ...results.map(result => [result.url, result.redirectUrl])
        ]);
        console.log("markdownTableString\n",markdownTableString);
      }

      async function run() {
        const Urls = [
          "/file",
          "/file/",
          "/folder",
          "/folder/",
          "/both",
          "/both/",
        ];
        const results = await Promise.all(Urls.map(fetchUrl))

        results.forEach(addUrlResultToDOM);

        printMarkdownTable(results);
      }

      run().catch(e => {
        console.error(e);
        alert("Error, check the console: " + e.message);
      });

  </script>
</body>
</html>
